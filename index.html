<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koumbia Map</title>
    <!-- CSS, mise en page -->
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        #map-container {
            position: absolute;
            top: 40px;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #nav-menu {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 40px;
            background-color: #333; /* Background color for the navigation menu */
            color: #fff; /* Text color for the menu items */
            z-index: 999;
        }
        #nav-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
        }
        #nav-menu li {
            padding: 10px 20px;
            cursor: pointer;
        }
        #info-panel {
            position: absolute;
            top: 40px;
            right: 0;
            width: 40%;
            height: 100%;
            background-color: #fff;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5);
            transform: translateX(100%); /* Adjusted initial position */
        }
        #info-panel-arrow {
            position: absolute;
            top: 50%;
            left: -20px; /* Adjusted left position to the left side of the panel */
            transform: translateY(-50%) rotate(90deg); /* Rotated to face right */
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #3a1414;
            cursor: pointer;
        }
        #map-in-panel {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <!-- section menu de la page -->
    <div id="nav-menu">
        <ul>
            <!-- lien hypertextes qui renvoient vers les sections dont l'ID est #menu, #infos et #contact. A DEFINIR -->
            <li><a href="#menu" style="text-decoration: none; color: #fff;">Menu</a></li>
            <li><a href="#infos" style="text-decoration: none; color: #fff;">Infos</a></li>
            <li><a href="#contact" style="text-decoration: none; color: #fff;">Contact</a></li>
        </ul>
    </div>

    <!-- map  -->
    <div id="map-container"></div>

    <!-- panel qui apparait quand on clique sur segment -->
    <div id="info-panel">
        <div id="info-content">
            <!-- Data will be displayed here when an area is clicked -->
        </div>
        <div id="info-panel-arrow" onclick="toggleInfoPanel()"></div>
        <div id="map-in-panel">
            <!-- New map will be displayed here when an area is clicked -->
        </div>
    </div>

    <!-- <div id="heatmap-container">
        <div id="heatmap"></div>
    </div> -->

    <script>
        let infoPanelVisible = false;
        let mapInPanel;
        let map;
        // let heatmap;
        // let heatmapContainerVisible = false;

        // function toggleHeatmapContainer() {
        //     const heatmapContainer = document.getElementById("heatmap-container");
        //     heatmapContainerVisible = !heatmapContainerVisible;

        //     if (heatmapContainerVisible) {
        //         heatmapContainer.style.width = "50%"; // Show the heatmap container
        //     } else {
        //         heatmapContainer.style.width = "0"; // Hide the heatmap container
        //     }
        // }

        function toggleInfoPanel() {
            const infoPanel = document.getElementById("info-panel");
            infoPanelVisible = !infoPanelVisible;

            if (infoPanelVisible) {
                infoPanel.style.transform = "translateX(0)"; // Show the panel
            } else {
                infoPanel.style.transform = "translateX(100%)"; // Hide the panel
            }
        }

        // fonction qui est appelée lorsque l'API google map est chargée (javascript)
        function initMap() {
            // study area = 2000 km^2 in Burkina Faso around the town of Koumbia
            // objets avec les propriétés lat et lng
            var topLeft = {lat: 11.37, lng: -3.89};
            var topRight = {lat: 11.37, lng: -3.42};
            var bottomRight = {lat: 10.96, lng: -3.42};
            var bottomLeft = {lat: 10.96, lng: -3.89};

            // Calculer le centre de la bounding box
            var centerCoordinates = {
                lat: (topLeft.lat + bottomRight.lat) / 2,
                lng: (topLeft.lng + bottomRight.lng) / 2
            };

            // charger la carte
            map = new google.maps.Map(document.getElementById('map-container'), {
                zoom: 8,
                center: centerCoordinates
            });

            // Créer une forme de rectangle pour représenter la bounding box
            var boundingBox = new google.maps.Polygon({
                map: map,
                paths: [topLeft, topRight, bottomRight, bottomLeft],
                strokeColor: '#FF0000', // rouge
                strokeOpacity: 1,
                strokeWeight: 2,
                fillColor: '#FF0000',
                fillOpacity: 0.2
            });

            // recupérer les coordonnées des segments à partir du fichier JSON (requête fetch)
            fetch('segments.json')
                // convertit la réponse en JSON
                .then(response => response.json())
                // traitement des donnnées récupérées
                .then(data => {
                    // Loop through the data and create polygons for each area
                    data.forEach((areaData) => {
                        const polygon = new google.maps.Polygon({
                            paths: areaData.coordinates.map(coord => ({
                                lat: parseFloat(coord.lat),
                                lng: parseFloat(coord.lng)
                            })),
                            map: map,
                        });

                        // Add click event listener to the polygon to open the info panel with data
                        polygon.addListener("click", () => {
                            const infoContent = `
                                <h3>Segment ID: ${areaData.segment_id}</h3>
                            `;
                            document.getElementById("info-content").innerHTML = infoContent; // affiche le segment ID dans info-panel -> info-content
                            toggleInfoPanel(); // Open or hide the panel when an area is clicked

                            // permet d'avior les coordonées du polygone
                            const polygon = new google.maps.Polygon({
                                paths: polygonCoordinates,
                                map: map,
                            });

                            // Calculer le centre géométrique du polygone
                            const centerLat = polygonCoordinates.reduce((sum, coord) => sum + coord.lat, 0) / polygonCoordinates.length;
                            const centerLng = polygonCoordinates.reduce((sum, coord) => sum + coord.lng, 0) / polygonCoordinates.length;

                            // Create a new map in the panel centered on the clicked area -> ON VEUT HEAT MAP
                            const mapOptions = {
                                center: new google.maps.LatLng(centerLat, centerLng),
                                zoom: 18,
                            };
                            mapInPanel = new google.maps.Map(document.getElementById("map-in-panel"), mapOptions);

                            // superposition d'image:
                            // limite de la superposition d'image
                            // const imageBounds = new google.maps.LatLngBounds(
                            //     new google.maps.LatLng(areaData.coordinates[0].lat, areaData.coordinates[0].lng),
                            //     new google.maps.LatLng(areaData.coordinates[1].lat, areaData.coordinates[1].lng)
                            // );
                            // const imageOverlay = new google.maps.GroundOverlay(
                            //     areaData.image, // Image URL
                            //     imageBounds
                            // );
                            // imageOverlay.setMap(mapInPanel);
                        });
                    });
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                });

            // Add click event listener to the polygon to toggle heatmap container
            // google.maps.event.addListener(polygon, 'click', function (event) {
            //     toggleHeatmapContainer();

            //     // Initialize or update the heatmap when the container is visible
            //     if (heatmapContainerVisible) {
            //         initializeHeatmap(heatmapData);
            //     }
            // });
        }

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAltD6Kd7wGiuY6dDsDwYavGL45e03BvLA&callback=initMap" async defer></script>
</body>
</html>