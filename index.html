<!DOCTYPE html>
<html>
    <head>
        <title>Koumbia Map</title>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAltD6Kd7wGiuY6dDsDwYavGL45e03BvLA&callback=initMap" 
        async defer></script>
        <script>
            var map;
            // fonction qui est appelée lorsque l'API google map est chargée (javascript)
            function initMap() {
                // study area = 2000 km^2 in Burkina Faso around the town of Koumbia
                var topLeft = {lat: 11.37, lng: -3.89};
                var topRight = {lat: 11.37, lng: -3.42};
                var bottomRight = {lat: 10.96, lng: -3.42};
                var bottomLeft = {lat: 10.96, lng: -3.89};

                // Calculer le centre de la bounding box
                var centerCoordinates = {
                    lat: (topLeft.lat + bottomRight.lat) / 2,
                    lng: (topLeft.lng + bottomRight.lng) / 2
                };

                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 8,
                    center: centerCoordinates
                });

                // Marqueur (point rouge) centré sur la zone d'étude
                // var marker = new google.maps.Marker({
                //     position: centerCoordinates,
                //     map: map,
                //     title: 'Bounding Box Center'
                // });

                // Créer une forme de rectangle pour représenter la bounding box
                var boundingBox = new google.maps.Polygon({
                    map: map,
                    paths: [topLeft, topRight, bottomRight, bottomLeft],
                    strokeColor: '#FF0000',
                    strokeOpacity: 1,
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 0.2
                });

                // Charger les segments à partir du fichier JSON
                fetch('segments.json')
                    .then(response => response.json())
                    .then(data => {
                        data.forEach(segment => {
                            var polygon = new google.maps.Polygon({
                                paths: segment.coordinates,
                                map: map,
                                strokeColor: '#0000FF',
                                strokeOpacity: 0.8,
                                strokeWeight: 2,
                                fillColor: '#0000FF',
                                fillOpacity: 0.35
                            });

                            // Ajouter un gestionnaire d'événements pour afficher des informations lorsque le segment est cliqué
                            google.maps.event.addListener(polygon, 'click', function (event) {
                                //alert('Segment ID: ' + segment.segment_id);
                                showHeatmap(segment.coordinates);
                            });
                        });
                    })
                    .catch(error => {
                        console.error('Erreur lors du chargement des segments:', error);
                    });
            }

            // Fonction pour afficher la heatmap dans la fenêtre de droite
            function showHeatmap(coordinates) {
                // Récupérer la div pour la heatmap
                var heatmapDiv = document.getElementById('heatmap');

                // Ajuster la largeur de la carte à 50%
                map.setOptions({
                    width: '50%'
                });

                // Créer une nouvelle instance de carte Google Maps centrée sur le polygone sélectionné
                var heatmapMap = new google.maps.Map(heatmapDiv, {
                    center: new google.maps.LatLng(coordinates[0].lat, coordinates[0].lng),
                    zoom: 14,
                    mapTypeId: 'satellite'  // Vous pouvez ajuster le type de carte selon vos besoins
                });

                // Ajouter la heatmap
                var heatmap = new google.maps.visualization.HeatmapLayer({
                    data: coordinates.map(coord => new google.maps.LatLng(coord.lat, coord.lng)),
                    map: heatmapMap
                });

                // Afficher la fenêtre de droite
                heatmapDiv.style.display = 'block';
            }
        </script>
    </head>
    <style>
        #map {
            width: 100%;
            height: 100vh;
        }

        #heatmap {
            position: fixed;
            top: 0;
            right: 0;
            width: 50%; /* Ajustez la largeur selon vos besoins */
            height: 100vh;
            display: none; /* Caché par défaut */
        }
    </style>
    <body>
        <!-- <div id="map" style="height: 100vh; width: 100%;"></div> -->
        <div id="map"></div>
        <div id="heatmap"></div>
    </body>
</html>